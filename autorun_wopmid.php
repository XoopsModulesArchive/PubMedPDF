<?phpinclude 'nheader.php';include 'include/xml.php';include 'include/wopmid.php';include 'include/db.php';include 'include/news.php';if ($isadmin != 1) {    redirect_header(MOD_URL, 2, _MD_NOTPERMITTED);}$updir = MOD_PATH . '/' . UPXML;$reg   = '';if ($handle = opendir($updir)) {    while (false !== ($file = readdir($handle)) {        if ($file != '.' && $file != '..') {            if ($pm_data = RETRIEVE_XML($updir, $file)) {                $Author  = '';                $Authors = explode(',', $pm_data['a']);                foreach ($Authors as $a) {                    $Author .= trim($a) . ', ';                }                $pm_data['a'] = substr($Author, 0, -2);                # 消すな                foreach ($pm_data as $key => $value) {                    $pm_data[$key] = str_replace('"', '&#34;', $pm_data[$key]);                }                $data_id = wopmid($pm_data['y'], $pm_data['a'], $pm_data['j'], $pm_data['v'], $pm_data['p'], $pm_data['t']);                #echo $pm_data['c_t1'].'<br>'.$data_id;                # 旧バージョン対策                if ($pm_data['c_t1'] != $data_id) {                    $pm_data['c_t1'] = $data_id;                }                $sql = 'SELECT * FROM ' . $xoopsDB->prefix('pmid_id') . " WHERE Custom_t1='" . $data_id . "'";                $res = $xoopsDB->query($sql);                if (!$xoopsDB->getRowsNum($res)) {                    $reg .= '<div class="pt">' . $file . '</div>';                    $reg .= registDB($pm_data, $user, $xoopsModuleConfig['news']);                }            }        }    }}require XOOPS_ROOT_PATH . '/header.php';require __DIR__ . '/style.php';echo $reg;require XOOPS_ROOT_PATH . '/footer.php';function registDB($pm_data, $user, $news){    global $xoopsDB;    $ret = '';    $sql = 'SELECT * FROM ' . $xoopsDB->prefix('pmid_journal') . " WHERE Journal='" . $pm_data['j'] . "'";    $res = $xoopsDB->query($sql);    $row = $xoopsDB->fetchArray($res);    if (!$xoopsDB->getRowsNum($res))) {        $data['j']     = $pm_data['j'];        $data['j_jp']  = $pm_data['j_jp'];        $data['j_url'] = '';        $data['bk']    = '';        $data['e']     = '';        $data['pub']   = '';        REG_JOURNAL($data);        /*                    $ret.= "<div class=\"pt\">"."New journal is registered"."</div>";                    $ret.= "Name in English : ".$data['j']."<br>";                    $ret.= "Name in other Language : ".$data['j_jp']."<br><br>";        */    }    # registration    $pm_data['id'] = 0;    $seq_no        = DB($pm_data, $user);    $sql           = 'UPDATE ' . $xoopsDB->prefix('pmid_id') . " SET PMID='-" . $seq_no . "' WHERE id='" . $seq_no . "'";    $res           = $xoopsDB->query($sql);    $ret .= "<table style='margin-bottom:10px'>";    $ret .= "<tr><td class='head' style='width:100px'>Title</td><td class='even'>" . $pm_data['t'] . '<br>' . $pm_data['t_jp'] . '</td></tr>';    $ret .= "<tr><td class='head'>Author(s)</td><td class='even'>" . $pm_data['a'] . '<br>' . $pm_data['a_jp'] . '</td></tr>';    $ret .= "<tr><td class='head'>Journal</td><td class='even'>" . $pm_data['j'] . '<br>' . $pm_data['j_jp'] . '</td></tr>';    $ret .= "<tr><td class='head'>Volume</td><td class='even'>" . $pm_data['v'] . '</td></tr>';    $ret .= "<tr><td class='head'>Pages</td><td class='even'>" . $pm_data['p'] . '</td></tr>';    $ret .= "<tr><td class='head'>Year</td><td class='even'>" . $pm_data['y'] . '</td></tr>';    $ret .= "<tr><td class='head'>Abstract</td><td class='even'>" . $pm_data['ab'] . '</td></tr>';    $ret .= '</table>';    if ($news) {        NEWS_REGISTER('Reg.wo.PMID', $pm_data['t'], $pm_data['ab'], $user);    }    return $ret;}